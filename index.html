html>
<script src='https://d3js.org/d3.v6.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=500 height=500></svg>
<script>
    async function init() {
        let raw_data = await d3.csv('https://raw.githubusercontent.com/selenaalu/narrative-visualization/master/us-counties-2021-cases-masks.csv');

        let grouped_data = d3.group(raw_data, d => d.state);
        let data = Array.from(grouped_data, ([k, v]) => ({
            state: k,
            avg_cases: d3.mean(v, d => +d.cases_avg_per_100k),
            avg_deaths: d3.mean(v, d => +d.deaths_avg_per_100k)
        }));

        var margin = { top: 50, right: 50, bottom: 50, left: 50 },
            width = 500 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var x = d3.scaleLinear().domain(d3.extent(data, function(d) {return d.avg_cases})).range([0, width]);
        var y = d3.scaleLinear().domain(d3.extent(data, function(d) {return d.avg_deaths})).range([height, 0]);

        var svg = d3.select('svg')
            .append('g')
            .attr('transform','translate(' + margin.left + ',' + margin.top + ')');

        svg.selectAll('circles')
            .data(data)
            .enter()
            .append('circle')
            .attr('cx', function(d) {return x(d.avg_cases);})
            .attr('cy', function(d) {return y(d.avg_deaths);})
            .attr('r', 5);

        svg.append('g')
            .call(d3.axisLeft(y));

        svg.append('g')
            .attr('transform', 'translate(0,' + height + ')')
            .call(d3.axisBottom(x));
    }
</script>
</body>
</html>
